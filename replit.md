# Teachable Machine - مشروع التعلم الآلي

## نظرة عامة
تطبيق ويب كامل لتعلم الآلة في المتصفح باستخدام TensorFlow.js مع واجهة عربية احترافية. يتيح للمستخدمين تدريب نماذج تصنيف الصور بسهولة دون الحاجة لخادم أو برمجة.

## التاريخ
- **تاريخ الإنشاء**: 29 أكتوبر 2025
- **آخر تحديث**: 30 أكتوبر 2025 - 10:10 UTC (تصميم جديد)
- **آخر ميزة مضافة**: الالتقاط التلقائي من الكاميرا (29 أكتوبر 2025)
- **آخر إصلاح**: حل مشكلة "حدث خطأ أثناء التدريب" (29 أكتوبر 2025 - 19:00 UTC)

## المميزات الرئيسية

### ✅ المنجزة
1. **تعلم آلي في المتصفح** - TensorFlow.js مع MobileNet v2
2. **واجهة عربية كاملة** - RTL support مع ثيم داكن
3. **رفع صور متعددة** - دعم السحب والإفلات
4. **التقاط من الكاميرا** - دعم كامل للكاميرا المباشرة
5. **🆕 التقاط تلقائي** - التقاط صور من الكاميرا تلقائياً بفاصل زمني قابل للتعديل
6. **تدريب في الوقت الفعلي** - عرض التقدم والدقة
7. **تنبؤ متقدم** - رفع صور أو كاميرا مباشرة
8. **تصدير النموذج** - حفظ كملفات .json و .bin
9. **تصميم متجاوب** - جوال، تابلت، ديسكتوب
10. **كود موثق بالكامل** - تعليقات واضحة للتطوير المستقبلي
11. **CPU Backend Fallback** - يعمل بدون GPU/WebGL

### 🔄 مقترحات للتطوير المستقبلي
1. استيراد النماذج المحفوظة
2. زيادة البيانات (data augmentation)
3. مصفوفة الالتباس (confusion matrix)
4. دعم الفيديوهات
5. تبديل اللغة (عربي/إنجليزي)

## البنية التقنية

### Stack
- **Frontend**: HTML5, CSS3, Vanilla JavaScript (ES6+)
- **ML Library**: TensorFlow.js 4.11
- **Pre-trained Model**: MobileNet v2
- **Backend**: لا يوجد - كل شيء في المتصفح

### الملفات الرئيسية
```
/
├── index.html          # الصفحة الرئيسية مع هيكل HTML
├── style.css           # التنسيقات والثيم الداكن
├── app.js              # منطق التطبيق والتعلم الآلي
├── assets/             # الأصول (صور، أيقونات)
├── models/             # مجلد النماذج المدربة
├── README.md           # التوثيق
└── replit.md           # هذا الملف
```

### كيفية العمل
1. **استخراج الخصائص**: استخدام MobileNet لاستخراج features من الصور
2. **طبقة التصنيف**: بناء شبكة عصبية جديدة فوق MobileNet
3. **التدريب**: تدريب الطبقة الجديدة فقط (transfer learning)
4. **التنبؤ**: استخدام النموذج المدرب لتصنيف صور جديدة

## الاستخدام

### تشغيل المشروع
```bash
# الخادم يعمل تلقائياً على المنفذ 5000
python3 -m http.server 5000
```

### سير العمل
1. **إضافة بيانات التدريب**
   - حمّل صور متعددة لكل فئة
   - أو التقط صوراً من الكاميرا
   - 🆕 **الالتقاط التلقائي**: فعّل خيار "التقاط تلقائي" لالتقاط صور متعددة بشكل تلقائي
     - اختر الفاصل الزمني (0.1 - 3 ثواني)
     - ضع الأشياء المختلفة أمام الكاميرا
     - سيتم التقاط الصور تلقائياً دون الحاجة للنقر
   - على الأقل فئتان مع صور متعددة

2. **بدء التدريب**
   - انقر زر "بدء التدريب"
   - راقب التقدم والدقة

3. **التنبؤ**
   - حمّل صورة جديدة
   - أو استخدم الكاميرا المباشرة
   - شاهد النتائج مع نسب الثقة

4. **تصدير النموذج**
   - احفظ النموذج للاستخدام لاحقاً

## ملاحظات تقنية

### 🔧 الإصلاحات الأخيرة (29 أكتوبر 2025)

#### الإصلاح #1: فحص تحميل MobileNet (19:00 UTC)
**المشكلة**: "حدث خطأ أثناء التدريب"
**السبب الجذري**: 
- كان المستخدمون يحاولون التدريب قبل اكتمال تحميل نموذج MobileNet
- عند استدعاء `mobilenet.infer()` قبل التحميل، كان يحدث خطأ undefined

**الحل المطبق**:
1. ✅ إضافة فحص في `trainModel()` للتأكد من تحميل MobileNet قبل البدء
2. ✅ إضافة validation في `extractFeatures()` لمنع الاستدعاءات قبل الاستعداد
3. ✅ تحديث `checkTrainingReady()` لتعطيل زر التدريب حتى يكتمل التحميل
4. ✅ تحسين رسائل الخطأ لتكون واضحة وإرشادية بالعربية
5. ✅ إضافة alerts مع خطوات استكشاف الأخطاء

#### الإصلاح #2: خطأ Shape Mismatch (19:20 UTC)
**المشكلة**: "expected 4 dimension(s) but got array with shape 23,1,1280"
**السبب الجذري**:
- `mobilenet.infer()` يعيد shape `[1, 7, 7, 1280]` مع batch dimension
- `buildModel()` كان يتوقع `[7, 7, 1024]` بدلاً من `[7, 7, 1280]`

**الحل المطبق**:
1. ✅ إضافة `squeeze([0])` في `extractFeatures()` لإزالة batch dimension
2. ✅ تنظيف الذاكرة بـ `dispose()` لمنع memory leaks
3. ✅ تحديث `buildModel()` من `[7, 7, 1024]` إلى `[7, 7, 1280]`
4. ✅ إضافة logging في `prepareTrainingData()` للتحقق من shapes

#### الإصلاح #3: التحقق من البيانات وزر المسح (19:25 UTC)
**المشكلة**: المستخدمون الذين أضافوا صوراً قبل الإصلاح #2 يحصلون على أخطاء shape
**السبب**: البيانات القديمة المخزنة قبل إصلاح squeeze() لها شكل خاطئ

**الحل المطبق**:
1. ✅ إضافة logging تفصيلي في `extractFeatures()` لعرض أشكال الـ tensors
2. ✅ إضافة التحقق من الشكل في `prepareTrainingData()` لتخطي الميزات غير الصالحة
3. ✅ إضافة زر "🗑️ مسح جميع البيانات" مع حوار تأكيد
4. ✅ تنفيذ `clearAllData()` مع تنظيف صحيح للـ tensors
5. ✅ تعريب جميع رسائل الخطأ والتحذيرات

**النتيجة**:
- الآن التدريب يعمل بدون أخطاء ✓
- الذاكرة تُدار بشكل صحيح ✓
- رسائل خطأ واضحة بالعربية ✓
- المستخدمون يمكنهم البدء من جديد بسهولة ✓

#### الإصلاح #4: إصلاح طبقة MobileNet (حرج) (00:50 UTC)
**المشكلة**: استخدام الطبقة الخاطئة من MobileNet
**السبب**: 
- الكود كان يستخدم `mobilenet.infer(image, 'conv_preds')` الذي يعطي `[1, 1280]`
- النموذج كان يتوقع `[7, 7, 1280]`
- هذا تسبب في فشل التدريب دائماً

**الحل المطبق**:
1. ✅ تغيير إلى `mobilenet.infer(image, true)` للحصول على embeddings صحيحة
2. ✅ تحديث بنية النموذج لقبول مدخلات `[1280]`
3. ✅ إزالة طبقة flatten غير الضرورية
4. ✅ تحديث validation للتحقق من shape `[1280]`
5. ✅ تبسيط بنية النموذج للأداء الأفضل

**البنية الجديدة**:
- **قبل**: مدخلات `[7, 7, 1280]` → Flatten → Dense(128) → Dropout → Output
- **بعد**: مدخلات `[1280]` → Dense(128) → Dropout → Output

**النتيجة**:
- ✅ التدريب يعمل الآن بشكل صحيح
- ✅ الـ features لها الشكل الصحيح `[1280]`
- ✅ أداء أفضل مع features مجمّعة
- ✅ بنية أبسط وأسرع

**⚠️ مهم**: يجب مسح جميع البيانات القديمة واستخدام التطبيق من جديد!

#### التحديث #5: إخفاء خاصية التصدير (01:00 UTC)
**السبب**: بناءً على طلب المستخدم
**التغيير**: 
- ✅ تم إخفاء قسم "تصدير النموذج" من الواجهة
- ✅ الكود لا يزال موجوداً في حالة الحاجة إليه مستقبلاً

#### التحديث #6: تعديل العنوان (01:05 UTC)
**السبب**: بناءً على طلب المستخدم
**التغيير**: 
- ✅ تم تغيير عنوان التطبيق من "آلة التعلم الذكية" إلى "تعلم الآلة"
- ✅ تحديث جميع الملفات ذات الصلة (index.html, TEST_REPORT.md, TESTING.md)

#### التحديث #7: تصميم جديد احترافي (10:10 UTC)
**السبب**: بناءً على طلب المستخدم
**التغييرات الكبيرة**:
1. ✅ **خط Cairo العربي**: استبدال الخط بخط Cairo الاحترافي الخاص بالعربية
2. ✅ **ألوان جديدة**: 
   - اللون الأزرق الجديد: #3A8EF6
   - اللون البنفسجي: #6C63FF
   - خلفية داكنة جديدة: #0D1117
3. ✅ **تأثيرات محسّنة**:
   - Gradient للعناوين والأزرار (90deg بدلاً من 135deg)
   - تأثير Scale بدلاً من translateY للأزرار
   - تأثير pulse محسّن بتغيير الألوان
   - عنوان أكبر (2.2rem)
4. ✅ **Shadows محسّنة**: صناديق ظل بألوان تتناسب مع الألوان الجديدة

**النتيجة**:
- ✅ تصميم أكثر احترافية ونظافة
- ✅ خط عربي أفضل وأوضح
- ✅ ألوان متناسقة ومريحة للعين
- ✅ تأثيرات أنيقة وسلسة

---

### TensorFlow.js Backend
- يحاول التطبيق استخدام WebGL أولاً
- يتراجع تلقائياً إلى CPU إذا لم يكن WebGL متاحاً
- هذا يضمن التوافق مع جميع الأجهزة

### Transfer Learning
- استخدام MobileNet المدرب على ImageNet
- استخراج features من طبقة `conv_preds`
- تدريب طبقتين فقط (Dense + Output)
- هذا أسرع من التدريب من الصفر

### الأمان والخصوصية
- **لا يتم إرسال أي بيانات**: كل شيء يحدث في المتصفح
- **خصوصية كاملة**: صورك لا تغادر جهازك أبداً
- **لا يوجد تتبع**: لا analytics أو cookies

## الاستضافة والنشر

### متطلبات الاستضافة
- أي خادم ملفات ثابت (static file server)
- لا حاجة لقاعدة بيانات
- لا حاجة لـ backend

### منصات الاستضافة المقترحة
- GitHub Pages
- Netlify
- Vercel
- Replit (مع النشر المباشر)

### متطلبات المتصفح
- دعم ES6 JavaScript
- WebGL أو WASM (لـ TensorFlow.js)
- getUserMedia API (للكاميرا)
- File API (لرفع الملفات)

## الصيانة والتطوير

### البنية المعمارية
```
User Image
    ↓
MobileNet Feature Extraction (frozen)
    ↓
Flatten Layer
    ↓
Dense Layer (128 neurons, ReLU)
    ↓
Dropout (0.5)
    ↓
Output Layer (Softmax)
    ↓
Predictions
```

### نصائح التطوير
1. **إضافة ميزة جديدة**: راجع التعليقات في app.js
2. **تعديل الواجهة**: استخدم CSS variables في style.css
3. **تحسين الأداء**: فكر في تقليل حجم النموذج
4. **دعم لغات إضافية**: أضف ملفات ترجمة

## المشاكل المعروفة والحلول

### WebGL غير متاح
- **المشكلة**: بعض البيئات لا تدعم WebGL
- **الحل**: التطبيق يتراجع تلقائياً لـ CPU backend

### الكاميرا لا تعمل
- **المشكلة**: المتصفح يحجب إذن الكاميرا
- **الحل**: تأكد من منح الإذن في إعدادات المتصفح

### التدريب بطيء
- **المشكلة**: CPU backend أبطأ من GPU
- **الحل**: استخدم متصفح يدعم WebGL أو قلل عدد الصور

## الترخيص
مفتوح المصدر - استخدمه بحرية!

## التواصل والدعم
للأسئلة أو الاقتراحات، راجع التوثيق في README.md

---
**آخر تحديث**: 29 أكتوبر 2025
